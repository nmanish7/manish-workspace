# ------------------------------------------------------------
# Author: Manish Das
# File: .tmux.conf
# Supported: tmux 3.5a
# Created: 2025-11-14
# Description: Personal configuration for workflow optimization
# Font Requirement: CaskaydiaCove Nerd Font
# Pkg Requirement: tmux 3.5a, tmux-plugins/tpm, fonts, xclip
# - to use tome, install tome inside vim
# ------------------------------------------------------------

#>>> TODO: Store custom config files separately <<<
# ------------------------------------------------------------
# Keep custom configs for Tmux inside ~/.tmux/myconfigs/
# mkdir -p ~/.tmux/myconfigs/
# cp reset_tmux.conf ~/.tmux/myconfigs/reset_tmux.conf
# cp tmux_toggle_zoom_reverse.sh ~/.tmux/myconfigs/tmux_toggle_zoom_reverse.sh
# cp other custom config files as needed
# ------------------------------------------------------------

#>>> Reset Tmux Settings <<<
# Load the reset script to clear previous settings
# Using tmux-reset plugin
# alternatively, you can source your custom reset file myconfigs/reset_tmux.conf
source-file ~/.tmux/plugins/tmux-reset/tmux-reset

#>>> Set Default Terminal <<<
# Improve color support
set -g default-terminal "screen-256color"
# set -g terminal-overrides 'xterm-256color:RGB' # Uncomment if needed for RGB support
# ------------------------------------------------------------

#>>> Sensible Defaults >>>
setw -g mode-keys vi                                              # Use vi keybindings in copy mode
set -g status-keys vi                                             # Use vi keybindings in status line
set -g history-limit 200000                                       # Increase scrollback buffer
set -g status-right '#(TZ="US/Pacific" date +"%%h %%d %%H:%%M")'  # Show date and time in status bar
set -g mouse on                         # Enable mouse support
set -g focus-events on                  # Enable focus events
set -g base-index 1                     # Start window numbering at 1
set -g detach-on-destroy off           # Don't end session when last window is closed
set -g renumber-windows on              # Renumber windows when one is closed
set -g escape-time 0                    # Reduce delay for escape sequences
set -g status-position top              # Position status bar at the top
set -g pane-active-border-style "fg=magenta,bg=default"     # Active pane border color
set -g pane-border-style "fg=brightblack,bg=default"        # Inactive pane border color
# ------------------------------------------------------------

#>>> Reload Tmux Config <<<
bind r source-file ~/.tmux.conf \; display-message "Tmux config reloaded!"
# ------------------------------------------------------------

#>>> Plugin Management >>>
# List of plugins :> First Install Tmux Plugin Manager (tpm), manually from github
# To install plugins, press prefix + I after starting tmux
# To update plugins, press prefix + U
# To remove unused plugins, press prefix + alt + u

set -g @plugin 'hallazzang/tmux-reset'
set -g @plugin 'tmux-plugins/tpm'
# set -g @plugin 'catppuccin/tmux'
set -g @plugin 'omerxx/catppuccin-tmux'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @plugin 'sainnhe/tmux-fzf'
set -g @plugin 'Morantron/tmux-fingers'
set -g @plugin 'laktak/tome'

#>>> Set tmux-fingers options <<<
set -g @fingers-key f

# You can define custom patterns like this
# set -g @fingers-pattern-0 'git rebase --(abort|continue)'

# Pattern where regex get from boundary to next bound which contains ".log, .out, .csv, .json, .py"
set -g @fingers-pattern-1 '[\w-]+.(log|out|csv|json|py|pl|sh|conf|pm)'

# Pattern for words with letters and underscores
# set -g @fingers-pattern-3 '\b[\w_]+\b'

#>>> Tome Setup <<<
# Set the path to your Tome notes directory
bind-key p split-window -v -p 20 "bash ~/open_playbook.sh"

#>>> Catppuccino Setup <<<
# Use Caskaydia Cove Nerd Font for proper icons rendering
set -g @catppuccin_window_left_separator ""
set -g @catppuccin_window_right_separator " "
set -g @catppuccin_window_middle_separator " █"
set -g @catppuccin_window_number_position "right"
set -g @catppuccin_window_default_fill "number"
set -g @catppuccin_window_default_text "#W"
set -g @catppuccin_window_current_fill "number"
set -g @catppuccin_window_current_text "#W#{?window_zoomed_flag,(),}"
set -g @catppuccin_status_modules_right "directory date_time"
set -g @catppuccin_status_modules_left "session"
set -g @catppuccin_status_left_separator  " "
set -g @catppuccin_status_right_separator " "
set -g @catppuccin_status_right_separator_inverse "no"
set -g @catppuccin_status_fill "icon"
set -g @catppuccin_status_connect_separator "no"
set -g @catppuccin_directory_text "#{b:pane_current_path}"
set -g @catppuccin_date_time_text "%H:%M"
set -g @catppuccin_flavour 'macchiato' # or frappe, macchiato, mocha, latte

#>>> Continuum Setup <<<
set -g @continuum-restore 'on'

#>>> Resurrect Setup <<<
set -g @resurrect-strategy-vim 'session' # for vim
set -g @resurrect-capture-pane-contents 'on' # capture pane contents
set -g @resurrect-dir '~/.tmux/tmuxresurrect' # specify the directory to save resurrect data
# ------------------------------------------------------------

#>>> Pane Switching <<<
# Use vim-like keys to switch panes
bind-key h select-pane -L
bind-key j select-pane -D
bind-key k select-pane -U
bind-key l select-pane -R

#>>> Pane Resizing <<<
bind -n M-j resize-pane -D 2
bind -n M-k resize-pane -U 2
bind -n M-h resize-pane -L 2
bind -n M-l resize-pane -R 2

#>>> Switching last used window <<<
bind-key b last-window

#>>> Automatically set window titles <<<
set-window-option -g automatic-rename on
set-option -g set-titles on
# ------------------------------------------------------------


#>>> THEME SETTINGS <<<
set -g status-bg black
set -g status-fg white
# set -g window-status-current-bg white # not support in tmux 3.5a
# set -g window-status-current-fg black # not support in tmux 3.5a
#set -g window-status-current-attr bold # not support in tmux 3.5a
set -g status-interval 60
set -g status-left-length 30
#------------------------------------------------------------

#>>> Setting buffer to clipboard keyword <<<
# These can be used as shortcuts in tmux to source files or load modules individually
# Usefull in the situation where you ssh into a remote server and want to quickly load your configurations
set-buffer -b vim "so ~/.vimrc"
set-buffer -b alias "source ~/.alias"
set-buffer -b aliasmin "source ~/.alias_min"
set-buffer -b vimmodule "module unload vim; module load vim/9.1"
#------------------------------------------------------------

#>>> Bindings to load buffer contents <<<
bind-key v run-shell "tmux paste-buffer -b vim"
bind-key a run-shell "tmux paste-buffer -b alias"
bind-key m run-shell "tmux paste-buffer -b aliasmin"
#------------------------------------------------------------

#>>> Toggle Mouse Mode <<<
bind M run-shell 'tmux set -g mouse #{?mouse,off,on}; tmux display-message "Mouse: #{?mouse,OFF,ON}"'
#------------------------------------------------------------

#>>> Treat underscore as a non-separator <<<
set-option -g word-separators " :>~"
#------------------------------------------------------------

#>>> Mouse Support <<<
# Double Click to select and copy a word
bind-key -n DoubleClick1Pane \
    select-pane \; \
    copy-mode -M \; \
    send-keys -X select-word \; \
    run-shell "sleep 0.10" \; \
    send-keys -X copy-pipe-and-cancel "xclip -i -selection clipboard" \; \
    run-shell "sleep 0.1" \; \
    display-message "Copied to clipboard"

# Triple Click to select and copy a line
bind-key -n TripleClick1Pane \
    select-pane \; \
    copy-mode -M \; \
    send-keys -X select-line \; \
    run-shell "sleep 0.10" \; \
    send-keys -X copy-pipe-and-cancel "xclip -i -selection clipboard" \; \
    run-shell "sleep 0.1" \; \
    display-message "Full line copied to clipboard"

#------------------------------------------------------------

#>>> Copy to clipboard <<<
# Use Enter in copy-mode to copy to system clipboard via xclip
bind-key -T copy-mode-vi Enter send-keys -X copy-pipe-and-cancel "xclip -i -selection clipboard -i"

# Copy using mouse drag
bind -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel "xclip -i -selection clipboard"

# Middle Mouse Click to paste
bind-key -n MouseDown2Pane paste-buffer
# bind-key -n MouseDown2Pane send-keys -l "Shift-Insert"

# Ctrl + v to paste buffer
bind-key -n C-v paste-buffer
#------------------------------------------------------------

#>>> Set Prefix Key <<<
set -g prefix `

# Send ` key for 
bind '`' send-keys '`'
#------------------------------------------------------------

#>>> Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf) <<<
run '~/.tmux/plugins/tpm/tpm'
# ------------------------------------------------------------

#>>> Unbind/bind additional keys as needed <<<

# Unbind the current tome key binding
unbind p

# Restore the original prefix + p binding
bind p previous-window

# Unbind the current P key binding
unbind P

# Bind P to open the tome playbook in a new horizontal pane top
bind P run-shell "~/.tmux/plugins/tome/tome-open-playbook"

# Use Alt + \ to write the backslash character
bind -n M-\\ run-shell 'tmux send-keys -l "\\"'
#------------------------------------------------------------

#>>> Toggle Zoom <<<
# Use \ key to toggle zoom mode for the non-active pane
bind-key -n '\' run-shell "~/.tmux/myconfigs/tmux_toggle_zoom_reverse.sh"
#------------------------------------------------------------

# End of .tmux.conf
#------------------------------------------------------------

#>>> For Vscode Users as required remote tmux integration <<<
# For VSCode Integration: Update environment variables
# set-option -g update-environment "VSCODE_IPC_HOOK_CLI VSCODE_AGENT_FOLDER DISPLAY SSH_AUTH_SOCK"

# Keep this setting in VSCODE settings.json to use tmux as integrated terminal
#    "terminal.integrated.allowMnemonics": true,
#    "terminal.integrated.profiles.linux": {
#        "tmux-shell": {
#            "path": "tmux",
#            "args": ["new", "-As",  "vscode-${workspaceFolderBasename}"],
#            "env": {
#            "VSCODE_IPC_HOOK_CLI": "${env:VSCODE_IPC_HOOK_CLI}",
#            "VSCODE_AGENT_FOLDER": "${env:VSCODE_AGENT_FOLDER}"
#            }
#        }
#    },
#    "terminal.integrated.defaultProfile.linux": "tmux-shell",
#    "editor.fontFamily": "CaskaydiaCove Nerd Font",

# Vscode Keybinding to toggle full screen when terminal is focused
#    {
#    "key": "alt+enter",
#    "command": "workbench.action.toggleFullScreen",
#    "when": "terminalFocus"
#    }